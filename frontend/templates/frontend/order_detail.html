{% extends "frontend/base.html" %}
{% block title %}Заявка {{ order.code }}{% endblock %}
{% block content %}
<section class="dashboard">
    <h1>Заявка {{ order.code }}</h1>

    <div class="actions">
        <a href="{% url 'frontend:order_copy' order.pk %}" class="button secondary">Копировать</a>
        <a href="{% url 'frontend:order_edit' order.pk %}" class="button">Редактировать</a>
        <a href="{% url 'frontend:orders_list' %}" class="button outline">К списку</a>
    </div>

    <div class="detail-grid">
        <div>
            <h2>Основная информация</h2>
            <dl>
                <dt>Описание</dt><dd>{{ order.description }}</dd>
                <dt>Маршрут</dt><dd>{{ order.route_from }} → {{ order.route_to }}</dd>
                <dt>Места</dt><dd>{{ order.places }}</dd>
                <dt>Вес</dt><dd>{{ order.weight_kg }} кг</dd>
                <dt>Объём</dt><dd>{{ order.volume_m3|default:"—" }} м³</dd>
            </dl>
        </div>
        <div>
            <h2>Финансы</h2>
            <dl>
                <dt>Ставка</dt><dd>{{ order.rate|default:"—" }}</dd>
                <dt>Статус НДС</dt><dd>{{ order.get_vat_status_display }}</dd>
                <dt>Счёт</dt><dd>{{ order.invoice_number|default:"—" }}</dd>
                <dt>Акт</dt><dd>{{ order.act_number|default:"—" }}</dd>
                <dt>Счёт-фактура</dt><dd>{{ order.invoice_act_number|default:"—" }}</dd>
            </dl>
        </div>
        <div>
            <h2>Водители</h2>
            <dl>
                <dt>Основной водитель</dt><dd>{{ order.driver|default:"—" }}</dd>
                <dt>Водитель по документам</dt><dd>{{ order.document_driver|default:"—" }}</dd>
            </dl>
        </div>
        <div>
            <h2>Транспорт</h2>
            <dl>
                <dt>Машина по факту</dt><dd>{{ order.actual_vehicle|default:"—" }}</dd>
                <dt>Машина по документам</dt><dd>{{ order.document_vehicle|default:"—" }}</dd>
            </dl>
        </div>
        <div>
            <h2>Почтовое отправление</h2>
            {% if object.postal_records.exists %}
                {% for rec in object.postal_records.all %}
                    <p>RPO: {{ rec.rpo_number }} ({{ rec.get_service_display }})<br>
                       Дата отправки: {{ rec.shipping_date|default:"—" }}<br>
                       Дата доставки: {{ rec.delivery_date|default:"—" }}
                    </p>
                    <a href="{% url 'warehouse:postal_edit' rec.pk %}" class="button">Редактировать</a>
                {% endfor %}
                <p><a href="{% url 'warehouse:postal_create' %}?order={{ object.pk }}" class="button">Добавить ещё отправление</a></p>
            {% else %}
                <p>Почтовых отправлений нет</p>
                <a href="{% url 'warehouse:postal_create' %}?order={{ object.pk }}" class="button">Добавить RPO</a>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}