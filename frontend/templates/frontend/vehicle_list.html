{% extends "frontend/base.html" %}
{% block content %}
<section class="dashboard">
    <h1>
        {% if vehicle_type == 'cars' %}
            Список автомобилей
        {% elif vehicle_type == 'trailers' %}
            Список полуприцепов
        {% else %}
            Транспортные средства
        {% endif %}
    </h1>

    <p>
    {% if vehicle_type == 'cars' %}
        <a class="button" href="{% url 'frontend:vehicle_create' %}">Добавить автомобиль</a>
    {% elif vehicle_type == 'trailers' %}
        <a class="button" href="{% url 'frontend:trailer_create' %}">Добавить полуприцеп</a>
    {% endif %}
    </p>

    {% if vehicles %}
        <table class="table">
            <thead>
                <tr>
                    <th>Госномер</th>
                    <th>Марка</th>
                    <th>Статус</th>
                    <!-- Меняем заголовок в зависимости от типа -->
                    {% if vehicle_type == 'trailers' %}
                        <th>Привязан к</th>
                    {% else %}
                        <th>Прицеп</th>
                    {% endif %}
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for vehicle in vehicles %}
                    <tr>
                        <td><a href="{% url 'frontend:vehicle_detail' vehicle.pk %}">{{ vehicle.plate_number }}</a></td>
                        <td>{{ vehicle.brand }}</td>
                        <td>{{ vehicle.get_status_display }}</td>

                        <td>
                            {% if vehicle.is_collector %}
                                {% if vehicle.hitched_to %}
                                    {{ vehicle.hitched_to.plate_number }}
                                {% else %}
                                    —
                                {% endif %}
                            {% else %}
                                <!-- Выводим первый прицепленный, если он есть -->
                                {% with vehicle.trailers.first as trailer %}
                                    {% if trailer %}
                                        {{ trailer.plate_number }}
                                    {% else %}
                                        —
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        </td>

                        <td class="actions">
                            <a href="{% url 'frontend:vehicle_edit' vehicle.pk %}" class="link-edit">✏️</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% include "frontend/pagination.html" %}
    {% else %}
        <p>
            {% if vehicle_type == 'cars' %}
                <a class="button" href="{% url 'frontend:vehicle_create' %}">Добавить автомобиль</a>
            {% elif vehicle_type == 'trailers' %}
                <a class="button" href="{% url 'frontend:trailer_create' %}">Добавить полуприцеп</a>
            {% endif %}
        </p>
    {% endif %}
</section>
{% endblock %}